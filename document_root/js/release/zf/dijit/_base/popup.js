/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.popup"]){dojo._hasResource["dijit._base.popup"]=true;dojo.provide("dijit._base.popup");dojo.require("dijit._base.focus");dojo.require("dijit._base.place");dojo.require("dijit._base.window");dijit.popup={_stack:[],_beginZIndex:1000,_idGen:1,_wrappers:[],moveOffScreen:function(_1){var s=_1.style;s.visibility="hidden";s.position="absolute";s.top="-9999px";if(s.display=="none"){s.display="";}dojo.body().appendChild(_1);},getTopPopup:function(){var _2=this._stack;for(var pi=_2.length-1;pi>0&&_2[pi].parent===_2[pi-1].widget;pi--){}return _2[pi];},open:function(_3){var _4=this._stack,_5=_3.popup,_6=_3.orient||(dojo._isBodyLtr()?{"BL":"TL","BR":"TR","TL":"BL","TR":"BR"}:{"BR":"TR","BL":"TL","TR":"BR","TL":"BL"}),_7=_3.around,id=(_3.around&&_3.around.id)?(_3.around.id+"_dropdown"):("popup_"+this._idGen++);var _8=this._wrappers.pop(),_9,_a;if(!_8){_9=dojo.create("div",{"class":"dijitPopup"},dojo.body());dijit.setWaiRole(_9,"presentation");}else{_9=_8[0];_a=_8[1];}dojo.attr(_9,{id:id,style:{zIndex:this._beginZIndex+_4.length,visibility:"hidden",top:"-9999px"},"class":"dijitPopup "+(_5.baseClass||_5["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:_3.parent?_3.parent.id:""});var s=_5.domNode.style;s.display="";s.visibility="";s.position="";s.top="0px";_9.appendChild(_5.domNode);if(!_a){_a=new dijit.BackgroundIframe(_9);}else{_a.resize(_9);}var _b=_7?dijit.placeOnScreenAroundElement(_9,_7,_6,_5.orient?dojo.hitch(_5,"orient"):null):dijit.placeOnScreen(_9,_3,_6=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],_3.padding);_9.style.visibility="visible";var _c=[];_c.push(dojo.connect(_9,"onkeypress",this,function(_d){if(_d.charOrCode==dojo.keys.ESCAPE&&_3.onCancel){dojo.stopEvent(_d);_3.onCancel();}else{if(_d.charOrCode===dojo.keys.TAB){dojo.stopEvent(_d);var _e=this.getTopPopup();if(_e&&_e.onCancel){_e.onCancel();}}}}));if(_5.onCancel){_c.push(dojo.connect(_5,"onCancel",_3.onCancel));}_c.push(dojo.connect(_5,_5.onExecute?"onExecute":"onChange",this,function(){var _f=this.getTopPopup();if(_f&&_f.onExecute){_f.onExecute();}}));_4.push({wrapper:_9,iframe:_a,widget:_5,parent:_3.parent,onExecute:_3.onExecute,onCancel:_3.onCancel,onClose:_3.onClose,handlers:_c});if(_5.onOpen){_5.onOpen(_b);}return _b;},close:function(_10){var _11=this._stack;while(dojo.some(_11,function(_12){return _12.widget==_10;})){var top=_11.pop(),_13=top.wrapper,_14=top.iframe,_15=top.widget,_16=top.onClose;if(_15.onClose){_15.onClose();}dojo.forEach(top.handlers,dojo.disconnect);if(_15&&_15.domNode){this.moveOffScreen(_15.domNode);}_13.style.top="-9999px";_13.style.visibility="hidden";this._wrappers.push([_13,_14]);if(_16){_16();}}}};dijit._frames=new function(){var _17=[];this.pop=function(){var _18;if(_17.length){_18=_17.pop();_18.style.display="";}else{if(dojo.isIE){var _19=dojo.config["dojoBlankHtmlUrl"]||(dojo.moduleUrl("dojo","resources/blank.html")+"")||"javascript:\"\"";var _1a="<iframe src='"+_19+"'"+" style='position: absolute; left: 0px; top: 0px;"+"z-index: -1; filter:Alpha(Opacity=\"0\");'>";_18=dojo.doc.createElement(_1a);}else{_18=dojo.create("iframe");_18.src="javascript:\"\"";_18.className="dijitBackgroundIframe";dojo.style(_18,"opacity",0.1);}_18.tabIndex=-1;}return _18;};this.push=function(_1b){_1b.style.display="none";_17.push(_1b);};}();dijit.BackgroundIframe=function(_1c){if(!_1c.id){throw new Error("no id");}if(dojo.isIE||dojo.isMoz){var _1d=dijit._frames.pop();_1c.appendChild(_1d);if(dojo.isIE<7){this.resize(_1c);this._conn=dojo.connect(_1c,"onresize",this,function(){this.resize(_1c);});}else{dojo.style(_1d,{width:"100%",height:"100%"});}this.iframe=_1d;}};dojo.extend(dijit.BackgroundIframe,{resize:function(_1e){if(this.iframe&&dojo.isIE<7){dojo.style(this.iframe,{width:_1e.offsetWidth+"px",height:_1e.offsetHeight+"px"});}},destroy:function(){if(this._conn){dojo.disconnect(this._conn);this._conn=null;}if(this.iframe){dijit._frames.push(this.iframe);delete this.iframe;}}});}