/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo.io.iframe"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo.io.iframe"]){_4._hasResource["dojo.io.iframe"]=true;_4.provide("dojo.io.iframe");_4.io.iframe={create:function(_7,_8,_9){if(window[_7]){return window[_7];}if(window.frames[_7]){return window.frames[_7];}var _a=null;var _b=_9;if(!_b){if(_4.config["useXDomain"]&&!_4.config["dojoBlankHtmlUrl"]){console.warn("dojo.io.iframe.create: When using cross-domain Dojo builds,"+" please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl"+" to the path on your domain to blank.html");}_b=(_4.config["dojoBlankHtmlUrl"]||_4.moduleUrl("dojo","resources/blank.html"));}var _c=_4.isIE?"<iframe name=\""+_7+"\" src=\""+_b+"\" onload=\""+_8+"\">":"iframe";_a=_4.doc.createElement(_c);with(_a){name=_7;setAttribute("name",_7);id=_7;}_4.body().appendChild(_a);window[_7]=_a;with(_a.style){if(!(_4.isSafari<3)){position="absolute";}left=top="1px";height=width="1px";visibility="hidden";}if(!_4.isIE){this.setSrc(_a,_b,true);_a.onload=new Function(_8);}return _a;},setSrc:function(_d,_e,_f){try{if(!_f){if(_4.isWebKit){_d.location=_e;}else{frames[_d.name].location=_e;}}else{var _10;if(_4.isIE||_4.isWebKit>521){_10=_d.contentWindow.document;}else{if(_4.isSafari){_10=_d.document;}else{_10=_d.contentWindow;}}if(!_10){_d.location=_e;return;}else{_10.location.replace(_e);}}}catch(e){console.log("dojo.io.iframe.setSrc: ",e);}},doc:function(_11){var doc=_11.contentDocument||(((_11.name)&&(_11.document)&&(_4.doc.getElementsByTagName("iframe")[_11.name].contentWindow)&&(_4.doc.getElementsByTagName("iframe")[_11.name].contentWindow.document)))||((_11.name)&&(_4.doc.frames[_11.name])&&(_4.doc.frames[_11.name].document))||null;return doc;},send:function(_12){if(!this["_frame"]){this._frame=this.create(this._iframeName,_4._scopeName+".io.iframe._iframeOnload();");}var dfd=_4._ioSetArgs(_12,function(dfd){dfd.canceled=true;dfd.ioArgs._callNext();},function(dfd){var _13=null;try{var _14=dfd.ioArgs;var dii=_4.io.iframe;var ifd=dii.doc(dii._frame);var _15=_14.handleAs;_13=ifd;if(_15!="html"){if(_15=="xml"){if(_4.isIE){_4.query("a",dii._frame.contentWindow.document.documentElement).orphan();var _16=(dii._frame.contentWindow.document).documentElement.innerText;_16=_16.replace(/>\s+</g,"><");_16=_4.trim(_16);var _17={responseText:_16};_13=_4._contentHandlers["xml"](_17);}}else{_13=ifd.getElementsByTagName("textarea")[0].value;if(_15=="json"){_13=_4.fromJson(_13);}else{if(_15=="javascript"){_13=_4.eval(_13);}}}}}catch(e){_13=e;}finally{_14._callNext();}return _13;},function(_18,dfd){dfd.ioArgs._hasError=true;dfd.ioArgs._callNext();return _18;});dfd.ioArgs._callNext=function(){if(!this["_calledNext"]){this._calledNext=true;_4.io.iframe._currentDfd=null;_4.io.iframe._fireNextRequest();}};this._dfdQueue.push(dfd);this._fireNextRequest();_4._ioWatch(dfd,function(dfd){return !dfd.ioArgs["_hasError"];},function(dfd){return (!!dfd.ioArgs["_finished"]);},function(dfd){if(dfd.ioArgs._finished){dfd.callback(dfd);}else{dfd.errback(new Error("Invalid dojo.io.iframe request state"));}});return dfd;},_currentDfd:null,_dfdQueue:[],_iframeName:_4._scopeName+"IoIframe",_fireNextRequest:function(){try{if((this._currentDfd)||(this._dfdQueue.length==0)){return;}do{var dfd=this._currentDfd=this._dfdQueue.shift();}while(dfd&&dfd.canceled&&this._dfdQueue.length);if(!dfd||dfd.canceled){this._currentDfd=null;return;}var _19=dfd.ioArgs;var _1a=_19.args;_19._contentToClean=[];var fn=_4.byId(_1a["form"]);var _1b=_1a["content"]||{};if(fn){if(_1b){var _1c=function(_1d,_1e){var tn;if(_4.isIE){tn=_4.doc.createElement("<input type='hidden' name='"+_1d+"'>");}else{tn=_4.doc.createElement("input");tn.type="hidden";tn.name=_1d;}tn.value=_1e;fn.appendChild(tn);_19._contentToClean.push(_1d);};for(var x in _1b){var val=_1b[x];if(_4.isArray(val)&&val.length>1){var i;for(i=0;i<val.length;i++){_1c(x,val[i]);}}else{if(!fn[x]){_1c(x,val);}else{fn[x].value=val;}}}}var _1f=fn.getAttributeNode("action");var _20=fn.getAttributeNode("method");var _21=fn.getAttributeNode("target");if(_1a["url"]){_19._originalAction=_1f?_1f.value:null;if(_1f){_1f.value=_1a.url;}else{fn.setAttribute("action",_1a.url);}}if(!_20||!_20.value){if(_20){_20.value=(_1a["method"])?_1a["method"]:"post";}else{fn.setAttribute("method",(_1a["method"])?_1a["method"]:"post");}}_19._originalTarget=_21?_21.value:null;if(_21){_21.value=this._iframeName;}else{fn.setAttribute("target",this._iframeName);}fn.target=this._iframeName;_4._ioNotifyStart(dfd);fn.submit();}else{var _22=_1a.url+(_1a.url.indexOf("?")>-1?"&":"?")+_19.query;_4._ioNotifyStart(dfd);this.setSrc(this._frame,_22,true);}}catch(e){dfd.errback(e);}},_iframeOnload:function(){var dfd=this._currentDfd;if(!dfd){this._fireNextRequest();return;}var _23=dfd.ioArgs;var _24=_23.args;var _25=_4.byId(_24.form);if(_25){var _26=_23._contentToClean;for(var i=0;i<_26.length;i++){var key=_26[i];for(var j=0;j<_25.childNodes.length;j++){var _27=_25.childNodes[j];if(_27.name==key){_4.destroy(_27);break;}}}if(_23["_originalAction"]){_25.setAttribute("action",_23._originalAction);}if(_23["_originalTarget"]){_25.setAttribute("target",_23._originalTarget);_25.target=_23._originalTarget;}}_23._finished=true;}};}}};});