/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.drawing.manager.Mouse"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.drawing.manager.Mouse"]){_4._hasResource["dojox.drawing.manager.Mouse"]=true;_4.provide("dojox.drawing.manager.Mouse");_6.drawing.manager.Mouse=_6.drawing.util.oo.declare(function(_7){this.util=_7.util;this.keys=_7.keys;this.id=_7.id||this.util.uid("mouse");this.currentNodeId="";this.registered={};},{doublClickSpeed:400,_lastx:0,_lasty:0,__reg:0,_downOnCanvas:false,init:function(_8){this.container=_8;this.setCanvas();var c;var _9=false;_4.connect(this.container,"rightclick",this,function(_a){console.warn("RIGHTCLICK");});_4.connect(document.body,"mousedown",this,function(_b){});_4.connect(this.container,"mousedown",this,function(_c){this.down(_c);_9=true;c=_4.connect(document,"mousemove",this,"drag");});_4.connect(document,"mouseup",this,function(_d){_4.disconnect(c);_9=false;this.up(_d);});_4.connect(document,"mousemove",this,function(_e){if(!_9){this.move(_e);}});_4.connect(this.keys,"onEsc",this,function(_f){this._dragged=false;});},setCanvas:function(){var pos=_4.coords(this.container.parentNode);this.origin=_4.clone(pos);},scrollOffset:function(){return {top:this.container.parentNode.scrollTop,left:this.container.parentNode.scrollLeft};},register:function(_10){var _11=_10.id||"reg_"+(this.__reg++);if(!this.registered[_11]){this.registered[_11]=_10;}return _11;},unregister:function(_12){if(!this.registered[_12]){return;}delete this.registered[_12];},_broadcastEvent:function(_13,obj){for(var nm in this.registered){if(this.registered[nm][_13]){this.registered[nm][_13](obj);}}},onDown:function(obj){this._broadcastEvent(this.eventName("down"),obj);},onDrag:function(obj){var nm=this.eventName("drag");if(this._selected&&nm=="onDrag"){nm="onStencilDrag";}this._broadcastEvent(nm,obj);},onMove:function(obj){this._broadcastEvent("onMove",obj);},overName:function(obj,evt){nm=obj.id.split(".");evt=evt.charAt(0).toUpperCase()+evt.substring(1);if(nm[0]=="dojox"&&(_6.drawing.defaults.clickable||!_6.drawing.defaults.clickMode)){return "onStencil"+evt;}else{return "on"+evt;}},onOver:function(obj){this._broadcastEvent(this.overName(obj,"over"),obj);},onOut:function(obj){this._broadcastEvent(this.overName(obj,"out"),obj);},onUp:function(obj){var nm=this.eventName("up");if(nm=="onStencilUp"){this._selected=true;}else{if(this._selected&&nm=="onUp"){nm="onStencilUp";this._selected=false;}}console.info("Up Event:",this.id,nm,"id:",obj.id);this._broadcastEvent(nm,obj);if(_6.gfx.renderer=="silverlight"){return;}this._clickTime=new Date().getTime();if(this._lastClickTime){if(this._clickTime-this._lastClickTime<this.doublClickSpeed){var dnm=this.eventName("doubleClick");console.warn("DOUBLE CLICK",dnm,obj);this._broadcastEvent(dnm,obj);}else{}}this._lastClickTime=this._clickTime;},zoom:1,setZoom:function(_14){this.zoom=1/_14;},setEventMode:function(_15){this.mode=_15?"on"+_15.charAt(0).toUpperCase()+_15.substring(1):"";},eventName:function(_16){_16=_16.charAt(0).toUpperCase()+_16.substring(1);if(this.mode){if(this.mode=="onPathEdit"){return "on"+_16;}if(this.mode=="onUI"){}return this.mode+_16;}else{if(!_6.drawing.defaults.clickable&&_6.drawing.defaults.clickMode){return "on"+_16;}var dt=!this.drawingType||this.drawingType=="surface"||this.drawingType=="canvas"?"":this.drawingType;var t=!dt?"":dt.charAt(0).toUpperCase()+dt.substring(1);return "on"+t+_16;}},up:function(evt){this.onUp(this.create(evt));},down:function(evt){evt.preventDefault();_4.stopEvent(evt);this._downOnCanvas=true;var sc=this.scrollOffset();var dim=this._getXY(evt);this._lastpagex=dim.x;this._lastpagey=dim.y;var o=this.origin;var x=dim.x-o.x;var y=dim.y-o.y;x*=this.zoom;y*=this.zoom;x+=sc.left*this.zoom;y+=sc.top*this.zoom;var _17=x>=0&&y>=0&&x<=o.w&&y<=o.h;o.startx=x;o.starty=y;this._lastx=x;this._lasty=y;this.drawingType=this.util.attr(evt,"drawingType")||"";var id=this._getId(evt);this.onDown({mid:this.id,x:x,y:y,pageX:dim.x,pageY:dim.y,withinCanvas:_17,id:id});},over:function(obj){this.onOver(obj);},out:function(obj){this.onOut(obj);},move:function(evt){var obj=this.create(evt);if(this.id=="MUI"){}if(obj.id!=this.currentNodeId){var _18={};for(var nm in obj){_18[nm]=obj[nm];}_18.id=this.currentNodeId;this.currentNodeId&&this.out(_18);obj.id&&this.over(obj);this.currentNodeId=obj.id;}this.onMove(obj);},drag:function(evt){this.onDrag(this.create(evt,true));},create:function(evt,_19){var sc=this.scrollOffset();var dim=this._getXY(evt);var _1a=dim.x;var _1b=dim.y;var x=dim.x-this.origin.x;var y=dim.y-this.origin.y;var o=this.origin;x+=sc.left;y+=sc.top;x*=this.zoom;y*=this.zoom;var _1c=x>=0&&y>=0&&x<=o.w&&y<=o.h;var id=_1c?this._getId(evt,_19):"";var ret={mid:this.id,x:x,y:y,pageX:dim.x,pageY:dim.y,page:{x:dim.x,y:dim.y},orgX:o.x,orgY:o.y,last:{x:this._lastx,y:this._lasty},start:{x:this.origin.startx,y:this.origin.starty},move:{x:_1a-this._lastpagex,y:_1b-this._lastpagey},scroll:sc,id:id,withinCanvas:_1c};this._lastx=x;this._lasty=y;this._lastpagex=_1a;this._lastpagey=_1b;_4.stopEvent(evt);return ret;},_getId:function(evt,_1d){return this.util.attr(evt,"id",null,_1d);},_getXY:function(evt){return {x:evt.pageX,y:evt.pageY};},setCursor:function(_1e,_1f){if(!_1f){_4.style(this.container,"cursor",_1e);}else{_4.style(_1f,"cursor",_1e);}}});}}};});