/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Scroller"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Scroller"]){_4._hasResource["dojox.grid._Scroller"]=true;_4.provide("dojox.grid._Scroller");(function(){var _7=function(_8){var i=0,n,p=_8.parentNode;while((n=p.childNodes[i++])){if(n==_8){return i-1;}}return -1;};var _9=function(_a){if(!_a){return;}var _b=function(_c){return _c.domNode&&_4.isDescendant(_c.domNode,_a,true);};var ws=_5.registry.filter(_b);for(var i=0,w;(w=ws[i]);i++){w.destroy();}delete ws;};var _d=function(_e){var _f=_4.byId(_e);return (_f&&_f.tagName?_f.tagName.toLowerCase():"");};var _10=function(_11,_12){var _13=[];var i=0,n;while((n=_11.childNodes[i])){i++;if(_d(n)==_12){_13.push(n);}}return _13;};var _14=function(_15){return _10(_15,"div");};_4.declare("dojox.grid._Scroller",null,{constructor:function(_16){this.setContentNodes(_16);this.pageHeights=[];this.pageNodes=[];this.stack=[];},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(_17,_18,_19){switch(arguments.length){case 3:this.rowsPerPage=_19;case 2:this.keepRows=_18;case 1:this.rowCount=_17;default:break;}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();if(this.scrollboxNode){this.scrollboxNode.scrollTop=0;this.scroll(0);this.scrollboxNode.onscroll=_4.hitch(this,"onscroll");}},_getPageCount:function(_1a,_1b){return _1a?(Math.ceil(_1a/_1b)||1):0;},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode;},setKeepInfo:function(_1c){this.keepRows=_1c;this.keepPages=!this.keepRows?this.keepPages:Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);},setContentNodes:function(_1d){this.contentNodes=_1d;this.colCount=(this.contentNodes?this.contentNodes.length:0);this.pageNodes=[];for(var i=0;i<this.colCount;i++){this.pageNodes[i]=[];}},getDefaultNodes:function(){return this.pageNodes[0]||[];},invalidate:function(){this._invalidating=true;this.invalidateNodes();this.pageHeights=[];this.height=(this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0);this.resize();this._invalidating=false;},updateRowCount:function(_1e){this.invalidateNodes();this.rowCount=_1e;var _1f=this.pageCount;if(_1f===0){this.height=1;}this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<_1f){for(var i=_1f-1;i>=this.pageCount;i--){this.height-=this.getPageHeight(i);delete this.pageHeights[i];}}else{if(this.pageCount>_1f){this.height+=this.defaultPageHeight*(this.pageCount-_1f-1)+this.calcLastPageHeight();}}this.resize();},pageExists:function(_20){return Boolean(this.getDefaultPageNode(_20));},measurePage:function(_21){if(this.grid.rowHeight){var _22=this.grid.rowHeight+1;return ((_21+1)*this.rowsPerPage>this.rowCount?this.rowCount-_21*this.rowsPerPage:this.rowsPerPage)*_22;}var n=this.getDefaultPageNode(_21);return (n&&n.innerHTML)?n.offsetHeight:undefined;},positionPage:function(_23,_24){for(var i=0;i<this.colCount;i++){this.pageNodes[i][_23].style.top=_24+"px";}},repositionPages:function(_25){var _26=this.getDefaultNodes();var _27=0;for(var i=0;i<this.stack.length;i++){_27=Math.max(this.stack[i],_27);}var n=_26[_25];var y=(n?this.getPageNodePosition(n)+this.getPageHeight(_25):0);for(var p=_25+1;p<=_27;p++){n=_26[p];if(n){if(this.getPageNodePosition(n)==y){return;}this.positionPage(p,y);}y+=this.getPageHeight(p);}},installPage:function(_28){for(var i=0;i<this.colCount;i++){this.contentNodes[i].appendChild(this.pageNodes[i][_28]);}},preparePage:function(_29,_2a){var p=(_2a?this.popPage():null);for(var i=0;i<this.colCount;i++){var _2b=this.pageNodes[i];var _2c=(p===null?this.createPageNode():this.invalidatePageNode(p,_2b));_2c.pageIndex=_29;_2b[_29]=_2c;}},renderPage:function(_2d){var _2e=[];var i,j;for(i=0;i<this.colCount;i++){_2e[i]=this.pageNodes[i][_2d];}for(i=0,j=_2d*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){this.renderRow(j,_2e);}},removePage:function(_2f){for(var i=0,j=_2f*this.rowsPerPage;i<this.rowsPerPage;i++,j++){this.removeRow(j);}},destroyPage:function(_30){for(var i=0;i<this.colCount;i++){var n=this.invalidatePageNode(_30,this.pageNodes[i]);if(n){_4.destroy(n);}}},pacify:function(_31){},pacifying:false,pacifyTicks:200,setPacifying:function(_32){if(this.pacifying!=_32){this.pacifying=_32;this.pacify(this.pacifying);}},startPacify:function(){this.startPacifyTicks=new Date().getTime();},doPacify:function(){var _33=(new Date().getTime()-this.startPacifyTicks)>this.pacifyTicks;this.setPacifying(true);this.startPacify();return _33;},endPacify:function(){this.setPacifying(false);},resize:function(){if(this.scrollboxNode){this.windowHeight=this.scrollboxNode.clientHeight;}for(var i=0;i<this.colCount;i++){_6.grid.util.setStyleHeightPx(this.contentNodes[i],Math.max(1,this.height));}var _34=(!this._invalidating);if(!_34){var ah=this.grid.attr("autoHeight");if(typeof ah=="number"&&ah<=Math.min(this.rowsPerPage,this.rowCount)){_34=true;}}if(_34){this.needPage(this.page,this.pageTop);}var _35=(this.page<this.pageCount-1)?this.rowsPerPage:((this.rowCount%this.rowsPerPage)||this.rowsPerPage);var _36=this.getPageHeight(this.page);this.averageRowHeight=(_36>0&&_35>0)?(_36/_35):0;},calcLastPageHeight:function(){if(!this.pageCount){return 0;}var _37=this.pageCount-1;var _38=((this.rowCount%this.rowsPerPage)||(this.rowsPerPage))*this.defaultRowHeight;this.pageHeights[_37]=_38;return _38;},updateContentHeight:function(_39){this.height+=_39;this.resize();},updatePageHeight:function(_3a,_3b){if(this.pageExists(_3a)){var oh=this.getPageHeight(_3a);var h=(this.measurePage(_3a));if(h===undefined){h=oh;}this.pageHeights[_3a]=h;if(oh!=h){this.updateContentHeight(h-oh);var ah=this.grid.attr("autoHeight");if((typeof ah=="number"&&ah>this.rowCount)||(ah===true&&!_3b)){this.grid.sizeChange();}else{this.repositionPages(_3a);}}return h;}return 0;},rowHeightChanged:function(_3c){this.updatePageHeight(Math.floor(_3c/this.rowsPerPage),false);},invalidateNodes:function(){while(this.stack.length){this.destroyPage(this.popPage());}},createPageNode:function(){var p=document.createElement("div");_4.attr(p,"role","presentation");p.style.position="absolute";p.style[_4._isBodyLtr()?"left":"right"]="0";return p;},getPageHeight:function(_3d){var ph=this.pageHeights[_3d];return (ph!==undefined?ph:this.defaultPageHeight);},pushPage:function(_3e){return this.stack.push(_3e);},popPage:function(){return this.stack.shift();},findPage:function(_3f){var i=0,h=0;for(var ph=0;i<this.pageCount;i++,h+=ph){ph=this.getPageHeight(i);if(h+ph>=_3f){break;}}this.page=i;this.pageTop=h;},buildPage:function(_40,_41,_42){this.preparePage(_40,_41);this.positionPage(_40,_42);this.installPage(_40);this.renderPage(_40);this.pushPage(_40);},needPage:function(_43,_44){var h=this.getPageHeight(_43),oh=h;if(!this.pageExists(_43)){this.buildPage(_43,this.keepPages&&(this.stack.length>=this.keepPages),_44);h=this.updatePageHeight(_43,true);}else{this.positionPage(_43,_44);}return h;},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop);},scroll:function(_45){this.grid.scrollTop=_45;if(this.colCount){this.startPacify();this.findPage(_45);var h=this.height;var b=this.getScrollBottom(_45);for(var p=this.page,y=this.pageTop;(p<this.pageCount)&&((b<0)||(y<b));p++){y+=this.needPage(p,y);}this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,_45);this.lastVisibleRow=this.getLastVisibleRow(p-1,y,b);if(h!=this.height){this.repositionPages(p-1);}this.endPacify();}},getScrollBottom:function(_46){return (this.windowHeight>=0?_46+this.windowHeight:-1);},processNodeEvent:function(e,_47){var t=e.target;while(t&&(t!=_47)&&t.parentNode&&(t.parentNode.parentNode!=_47)){t=t.parentNode;}if(!t||!t.parentNode||(t.parentNode.parentNode!=_47)){return false;}var _48=t.parentNode;e.topRowIndex=_48.pageIndex*this.rowsPerPage;e.rowIndex=e.topRowIndex+_7(t);e.rowTarget=t;return true;},processEvent:function(e){return this.processNodeEvent(e,this.contentNode);},renderRow:function(_49,_4a){},removeRow:function(_4b){},getDefaultPageNode:function(_4c){return this.getDefaultNodes()[_4c];},positionPageNode:function(_4d,_4e){},getPageNodePosition:function(_4f){return _4f.offsetTop;},invalidatePageNode:function(_50,_51){var p=_51[_50];if(p){delete _51[_50];this.removePage(_50,p);_9(p);p.innerHTML="";}return p;},getPageRow:function(_52){return _52*this.rowsPerPage;},getLastPageRow:function(_53){return Math.min(this.rowCount,this.getPageRow(_53+1))-1;},getFirstVisibleRow:function(_54,_55,_56){if(!this.pageExists(_54)){return 0;}var row=this.getPageRow(_54);var _57=this.getDefaultNodes();var _58=_14(_57[_54]);for(var i=0,l=_58.length;i<l&&_55<_56;i++,row++){_55+=_58[i].offsetHeight;}return (row?row-1:row);},getLastVisibleRow:function(_59,_5a,_5b){if(!this.pageExists(_59)){return 0;}var _5c=this.getDefaultNodes();var row=this.getLastPageRow(_59);var _5d=_14(_5c[_59]);for(var i=_5d.length-1;i>=0&&_5a>_5b;i--,row--){_5a-=_5d[i].offsetHeight;}return row+1;},findTopRow:function(_5e){var _5f=this.getDefaultNodes();var _60=_14(_5f[this.page]);for(var i=0,l=_60.length,t=this.pageTop,h;i<l;i++){h=_60[i].offsetHeight;t+=h;if(t>=_5e){this.offset=h-(t-_5e);return i+this.page*this.rowsPerPage;}}return -1;},findScrollTop:function(_61){var _62=Math.floor(_61/this.rowsPerPage);var t=0;var i,l;for(i=0;i<_62;i++){t+=this.getPageHeight(i);}this.pageTop=t;this.needPage(_62,this.pageTop);var _63=this.getDefaultNodes();var _64=_14(_63[_62]);var r=_61-this.rowsPerPage*_62;for(i=0,l=_64.length;i<l&&i<r;i++){t+=_64[i].offsetHeight;}return t;},dummy:0});})();}}};});