/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.plot2d.Candlesticks"],["require","dojox.charting.plot2d.common"],["require","dojox.charting.plot2d.Base"],["require","dojox.lang.utils"],["require","dojox.lang.functional"],["require","dojox.lang.functional.reversed"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.plot2d.Candlesticks"]){_4._hasResource["dojox.charting.plot2d.Candlesticks"]=true;_4.provide("dojox.charting.plot2d.Candlesticks");_4.require("dojox.charting.plot2d.common");_4.require("dojox.charting.plot2d.Base");_4.require("dojox.lang.utils");_4.require("dojox.lang.functional");_4.require("dojox.lang.functional.reversed");(function(){var df=_6.lang.functional,du=_6.lang.utils,dc=_6.charting.plot2d.common,_7=df.lambda("item.purgeGroup()");_4.declare("dojox.charting.plot2d.Candlesticks",_6.charting.plot2d.Base,{defaultParams:{hAxis:"x",vAxis:"y",gap:2,shadows:null},optionalParams:{minBarSize:1,maxBarSize:1},constructor:function(_8,_9){this.opt=_4.clone(this.defaultParams);du.updateWithObject(this.opt,_9);du.updateWithPattern(this.opt,_9,this.optionalParams);this.series=[];this.hAxis=this.opt.hAxis;this.vAxis=this.opt.vAxis;},collectStats:function(_a){var _b=_4.clone(dc.defaultStats);for(var i=0;i<_a.length;i++){var _c=_a[i];if(!_c.data.length){continue;}var _d=_b.vmin,_e=_b.vmax;if(!("ymin" in _c)||!("ymax" in _c)){_4.forEach(_c.data,function(_f,idx){var x=_f.x||idx+1;_b.hmin=Math.min(_b.hmin,x);_b.hmax=Math.max(_b.hmax,x);_b.vmin=Math.min(_b.vmin,_f.open,_f.close,_f.high,_f.low);_b.vmax=Math.max(_b.vmax,_f.open,_f.close,_f.high,_f.low);});}if("ymin" in _c){_b.vmin=Math.min(_d,_c.ymin);}if("ymax" in _c){_b.vmax=Math.max(_e,_c.ymax);}}return _b;},calculateAxes:function(dim){var _10=this.collectStats(this.series),t;_10.hmin-=0.5;_10.hmax+=0.5;this._calc(dim,_10);return this;},render:function(dim,_11){this.dirty=this.isDirty();if(this.dirty){_4.forEach(this.series,_7);this.cleanGroup();var s=this.group;df.forEachRev(this.series,function(_12){_12.cleanGroup(s);});}var t=this.chart.theme,_13,_14,_15,f,gap,_16,ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler),_17=Math.max(0,this._vScaler.bounds.lower),_18=vt(_17),_19=this.events();f=dc.calculateBarSize(this._hScaler.bounds.scale,this.opt);gap=f.gap;_16=f.size;this.resetEvents();for(var i=this.series.length-1;i>=0;--i){var run=this.series[i];if(!this.dirty&&!run.dirty){continue;}run.cleanGroup();var s=run.group;if(!run.fill||!run.stroke){_13=run.dyn.color=new _4.Color(t.next("color"));}_14=run.stroke?run.stroke:dc.augmentStroke(t.series.stroke,_13);_15=run.fill?run.fill:dc.augmentFill(t.series.fill,_13);for(var j=0;j<run.data.length;++j){var v=run.data[j];var x=ht(v.x||(j+0.5))+_11.l+gap,y=dim.height-_11.b,_1a=vt(v.open),_1b=vt(v.close),_1c=vt(v.high),low=vt(v.low);if("mid" in v){var mid=vt(v.mid);}if(low>_1c){var tmp=_1c;_1c=low;low=tmp;}if(_16>=1){var _1d=_1a>_1b;var _1e={x1:_16/2,x2:_16/2,y1:y-_1c,y2:y-low},_1f={x:0,y:y-Math.max(_1a,_1b),width:_16,height:Math.max(_1d?_1a-_1b:_1b-_1a,1)};shape=s.createGroup();shape.setTransform({dx:x,dy:0});var _20=shape.createGroup();_20.createLine(_1e).setStroke(_14);_20.createRect(_1f).setStroke(_14).setFill(_1d?_15:"white");if("mid" in v){_20.createLine({x1:(_14.width||1),x2:_16-(_14.width||1),y1:y-mid,y2:y-mid}).setStroke(_1d?{color:"white"}:_14);}run.dyn.fill=_15;run.dyn.stroke=_14;if(_19){var o={element:"candlestick",index:j,run:run,plot:this,hAxis:this.hAxis||null,vAxis:this.vAxis||null,shape:_20,x:x,y:y-Math.max(_1a,_1b),cx:_16/2,cy:(y-Math.max(_1a,_1b))+(Math.max(_1d?_1a-_1b:_1b-_1a,1)/2),width:_16,height:Math.max(_1d?_1a-_1b:_1b-_1a,1),data:v};this._connectEvents(shape,o);}}}run.dirty=false;}this.dirty=false;return this;}});})();}}};});