/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.charting.plot2d.Stacked"],["require","dojox.charting.plot2d.common"],["require","dojox.charting.plot2d.Default"],["require","dojox.lang.functional"],["require","dojox.lang.functional.sequence"],["require","dojox.lang.functional.reversed"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.charting.plot2d.Stacked"]){_4._hasResource["dojox.charting.plot2d.Stacked"]=true;_4.provide("dojox.charting.plot2d.Stacked");_4.require("dojox.charting.plot2d.common");_4.require("dojox.charting.plot2d.Default");_4.require("dojox.lang.functional");_4.require("dojox.lang.functional.sequence");_4.require("dojox.lang.functional.reversed");(function(){var df=_6.lang.functional,dc=_6.charting.plot2d.common,_7=df.lambda("item.purgeGroup()");_4.declare("dojox.charting.plot2d.Stacked",_6.charting.plot2d.Default,{calculateAxes:function(_8){var _9=dc.collectStackedStats(this.series);this._maxRunLength=_9.hmax;this._calc(_8,_9);return this;},render:function(_a,_b){if(this._maxRunLength<=0){return this;}var _c=df.repeat(this._maxRunLength,"-> 0",0);for(var i=0;i<this.series.length;++i){var _d=this.series[i];for(var j=0;j<_d.data.length;++j){var v=_d.data[j];if(isNaN(v)){v=0;}_c[j]+=v;}}this.dirty=this.isDirty();if(this.dirty){_4.forEach(this.series,_7);this.cleanGroup();var s=this.group;df.forEachRev(this.series,function(_e){_e.cleanGroup(s);});}var t=this.chart.theme,_f,_10,_11,_12,_13=this.events(),ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler);this.resetEvents();for(var i=this.series.length-1;i>=0;--i){var _d=this.series[i];if(!this.dirty&&!_d.dirty){continue;}_d.cleanGroup();var s=_d.group,_14=_4.map(_c,function(v,i){return {x:ht(i+1)+_b.l,y:_a.height-_b.b-vt(v)};},this);if(!_d.fill||!_d.stroke){_11=new _4.Color(t.next("color"));}var _15=this.opt.tension?dc.curve(_14,this.opt.tension):"";if(this.opt.areas){var _16=_4.clone(_14);var _17=_d.fill?_d.fill:dc.augmentFill(t.series.fill,_11);if(this.opt.tension){var p=dc.curve(_16,this.opt.tension);p+=" L"+_14[_14.length-1].x+","+(_a.height-_b.b)+" L"+_14[0].x+","+(_a.height-_b.b)+" L"+_14[0].x+","+_14[0].y;_d.dyn.fill=s.createPath(p).setFill(_17).getFill();}else{_16.push({x:_14[_14.length-1].x,y:_a.height-_b.b});_16.push({x:_14[0].x,y:_a.height-_b.b});_16.push(_14[0]);_d.dyn.fill=s.createPolyline(_16).setFill(_17).getFill();}}if(this.opt.lines||this.opt.markers){_f=_d.stroke?dc.makeStroke(_d.stroke):dc.augmentStroke(t.series.stroke,_11);if(_d.outline||t.series.outline){_10=dc.makeStroke(_d.outline?_d.outline:t.series.outline);_10.width=2*_10.width+_f.width;}}if(this.opt.markers){_12=_d.dyn.marker=_d.marker?_d.marker:t.next("marker");}var _18,_19,_1a;if(this.opt.shadows&&_f){var sh=this.opt.shadows,_1b=new _4.Color([0,0,0,0.3]),_1c=_4.map(_14,function(c){return {x:c.x+sh.dx,y:c.y+sh.dy};}),_1d=_4.clone(_10?_10:_f);_1d.color=_1b;_1d.width+=sh.dw?sh.dw:0;if(this.opt.lines){if(this.opt.tension){_d.dyn.shadow=s.createPath(dc.curve(_1c,this.opt.tension)).setStroke(_1d).getStroke();}else{_d.dyn.shadow=s.createPolyline(_1c).setStroke(_1d).getStroke();}}if(this.opt.markers){_1a=_4.map(_1c,function(c){return s.createPath("M"+c.x+" "+c.y+" "+_12).setStroke(_1d).setFill(_1b);},this);}}if(this.opt.lines){if(_10){if(this.opt.tension){_d.dyn.outline=s.createPath(_15).setStroke(_10).getStroke();}else{_d.dyn.outline=s.createPolyline(_14).setStroke(_10).getStroke();}}if(this.opt.tension){_d.dyn.stroke=s.createPath(_15).setStroke(_f).getStroke();}else{_d.dyn.stroke=s.createPolyline(_14).setStroke(_f).getStroke();}}if(this.opt.markers){_18=new Array(_14.length);_19=new Array(_14.length);_4.forEach(_14,function(c,i){var _1e="M"+c.x+" "+c.y+" "+_12;if(_10){_19[i]=s.createPath(_1e).setStroke(_10);}_18[i]=s.createPath(_1e).setStroke(_f).setFill(_f.color);},this);if(_13){_4.forEach(_18,function(s,i){var o={element:"marker",index:i,run:_d,plot:this,hAxis:this.hAxis||null,vAxis:this.vAxis||null,shape:s,outline:_19[i]||null,shadow:_1a&&_1a[i]||null,cx:_14[i].x,cy:_14[i].y,x:i+1,y:_d.data[i]};this._connectEvents(s,o);},this);}}_d.dirty=false;for(var j=0;j<_d.data.length;++j){var v=_d.data[j];if(isNaN(v)){v=0;}_c[j]-=v;}}this.dirty=false;return this;}});})();}}};});