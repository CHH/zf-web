/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.plugins.ViewSource"],["require","dijit._editor._Plugin"],["require","dijit.form.Button"],["require","dojo.i18n"],["requireLocalization","dijit._editor","commands",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.plugins.ViewSource"]){_4._hasResource["dijit._editor.plugins.ViewSource"]=true;_4.provide("dijit._editor.plugins.ViewSource");_4.require("dijit._editor._Plugin");_4.require("dijit.form.Button");_4.require("dojo.i18n");_4.declare("dijit._editor.plugins.ViewSource",_5._editor._Plugin,{stripScripts:true,stripComments:true,stripIFrames:true,readOnly:false,_fsPlugin:null,toggle:function(){if(_4.isWebKit){this._vsFocused=true;}this.button.attr("checked",!this.button.attr("checked"));},_initButton:function(){var _7=_4.i18n.getLocalization("dijit._editor","commands");this.button=new _5.form.ToggleButton({label:_7["viewSource"],showLabel:false,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ViewSource",tabIndex:"-1",onChange:_4.hitch(this,"_showSource")});if(_4.isIE==7){this._ieFixNode=_4.create("div",{style:{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}},_4.body());}this.button.attr("readOnly",false);},setEditor:function(_8){this.editor=_8;this._initButton();this.editor.addKeyHandler(_4.keys.F12,true,true,_4.hitch(this,function(e){this.button.focus();this.toggle();_4.stopEvent(e);setTimeout(_4.hitch(this,function(){this.editor.focus();}),100);}));},_showSource:function(_9){var ed=this.editor;var _a=ed._plugins;var _b;this._sourceShown=_9;var _c=this;try{if(!this.sourceArea){this._createSourceView();}if(_9){ed._sourceQueryCommandEnabled=ed.queryCommandEnabled;ed.queryCommandEnabled=function(_d){var _e=_d.toLowerCase();if(_e==="viewsource"){return true;}else{return false;}};this.editor.onDisplayChanged();_b=ed.attr("value");_b=this._filter(_b);ed.attr("value",_b);this._pluginList=[];this._disabledPlugins=_4.filter(_a,function(p){if(p&&p.button&&!p.button.attr("disabled")&&!(p instanceof _5._editor.plugins.ViewSource)){p._vs_updateState=p.updateState;p.updateState=function(){return false;};p.button.attr("disabled",true);if(p.command){switch(p.command){case "bold":case "italic":case "underline":case "strikethrough":case "superscript":case "subscript":p.button.attr("checked",false);break;default:break;}}return true;}});if(this._fsPlugin){this._fsPlugin._getAltViewNode=function(){return _c.sourceArea;};}this.sourceArea.value=_b;var is=_4.marginBox(ed.iframe.parentNode);_4.marginBox(this.sourceArea,{w:is.w,h:is.h});_4.style(ed.iframe,"display","none");_4.style(this.sourceArea,{display:"block"});var _f=function(){var vp=_5.getViewport();if("_prevW" in this&&"_prevH" in this){if(vp.w===this._prevW&&vp.h===this._prevH){return;}else{this._prevW=vp.w;this._prevH=vp.h;}}else{this._prevW=vp.w;this._prevH=vp.h;}if(this._resizer){clearTimeout(this._resizer);delete this._resizer;}this._resizer=setTimeout(_4.hitch(this,function(){delete this._resizer;this._resize();}),10);};this._resizeHandle=_4.connect(window,"onresize",this,_f);setTimeout(_4.hitch(this,this._resize),100);this.editor.onNormalizedDisplayChanged();}else{if(!ed._sourceQueryCommandEnabled){return;}_4.disconnect(this._resizeHandle);delete this._resizeHandle;ed.queryCommandEnabled=ed._sourceQueryCommandEnabled;if(!this._readOnly){_b=this.sourceArea.value;_b=this._filter(_b);ed.attr("value",_b);}_4.forEach(this._disabledPlugins,function(p){p.button.attr("disabled",false);if(p._vs_updateState){p.updateState=p._vs_updateState;}});this._disabledPlugins=null;_4.style(this.sourceArea,"display","none");_4.style(ed.iframe,"display","block");delete ed._sourceQueryCommandEnabled;this.editor.onDisplayChanged();}setTimeout(_4.hitch(this,function(){var _10=ed.domNode.parentNode;if(_10){var _11=_5.getEnclosingWidget(_10);if(_11&&_11.resize){_11.resize();}}ed.resize();}),300);}catch(e){console.log(e);}},_resize:function(){var ed=this.editor;var tbH=ed.getHeaderHeight();var fH=ed.getFooterHeight();var eb=_4.position(ed.domNode);var _12=_4._getPadBorderExtents(ed.iframe.parentNode);var _13=_4._getMarginExtents(ed.iframe.parentNode);var _14=_4._getPadBorderExtents(ed.domNode);var _15=_4._getMarginExtents(ed.domNode);var edb={w:eb.w-(_14.w+_15.w),h:eb.h-(tbH+_14.h+_15.h+fH)};if(this._fsPlugin&&this._fsPlugin.isFullscreen){var vp=_5.getViewport();edb.w=(vp.w-_14.w);edb.h=(vp.h-(tbH+_14.h+fH));}if(_4.isIE){edb.h-=2;}if(this._ieFixNode){var _16=-this._ieFixNode.offsetTop/1000;edb.w=Math.floor((edb.w+0.9)/_16);edb.h=Math.floor((edb.h+0.9)/_16);}_4.marginBox(this.sourceArea,{w:edb.w-(_12.w+_13.w),h:edb.h-(_12.h+_13.h)});_4.marginBox(ed.iframe.parentNode,{h:edb.h});},_createSourceView:function(){var ed=this.editor;var _17=ed._plugins;this.sourceArea=_4.create("textarea");if(this.readOnly){_4.attr(this.sourceArea,"readOnly",true);this._readOnly=true;}_4.style(this.sourceArea,{padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});_4.place(this.sourceArea,ed.iframe,"before");if(_4.isIE&&ed.iframe.parentNode.lastChild!==ed.iframe){_4.style(ed.iframe.parentNode.lastChild,{width:"0px",height:"0px",padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});}ed._viewsource_oldFocus=ed.focus;var _18=this;ed.focus=function(){if(_18._sourceShown){_18.setSourceAreaCaret();}else{try{if(this._vsFocused){delete this._vsFocused;_5.focus(ed.editNode);}else{ed._viewsource_oldFocus();}}catch(e){console.log(e);}}};var i,p;for(i=0;i<_17.length;i++){p=_17[i];if(p&&(p.declaredClass==="dijit._editor.plugins.FullScreen"||p.declaredClass===(_5._scopeName+"._editor.plugins.FullScreen"))){this._fsPlugin=p;break;}}if(this._fsPlugin){this._fsPlugin._viewsource_getAltViewNode=this._fsPlugin._getAltViewNode;this._fsPlugin._getAltViewNode=function(){return _18._sourceShown?_18.sourceArea:this._viewsource_getAltViewNode();};}this.connect(this.sourceArea,"onkeydown",_4.hitch(this,function(e){if(this._sourceShown&&e.keyCode==_4.keys.F12&&e.ctrlKey&&e.shiftKey){this.button.focus();this.button.attr("checked",false);setTimeout(_4.hitch(this,function(){ed.focus();}),100);_4.stopEvent(e);}}));},_stripScripts:function(_19){if(_19){_19=_19.replace(/<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>/ig,"");_19=_19.replace(/<\s*script\b([^<>]|\s)*>?/ig,"");_19=_19.replace(/<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>/ig,"");}return _19;},_stripComments:function(_1a){if(_1a){_1a=_1a.replace(/<!--(.|\s){1,}?-->/g,"");}return _1a;},_stripIFrames:function(_1b){if(_1b){_1b=_1b.replace(/<\s*iframe[^>]*>((.|\s)*?)<\\?\/\s*iframe\s*>/ig,"");}return _1b;},_filter:function(_1c){if(_1c){if(this.stripScripts){_1c=this._stripScripts(_1c);}if(this.stripComments){_1c=this._stripComments(_1c);}if(this.stripIFrames){_1c=this._stripIFrames(_1c);}}return _1c;},setSourceAreaCaret:function(){var win=_4.global;var _1d=this.sourceArea;_5.focus(_1d);if(this._sourceShown&&!this.readOnly){if(_4.isIE){if(this.sourceArea.createTextRange){var _1e=_1d.createTextRange();_1e.collapse(true);_1e.moveStart("character",-99999);_1e.moveStart("character",0);_1e.moveEnd("character",0);_1e.select();}}else{if(win.getSelection){if(_1d.setSelectionRange){_1d.setSelectionRange(0,0);}}}}},destroy:function(){if(this._ieFixNode){_4.body().removeChild(this._ieFixNode);}if(this._resizer){clearTimeout(this._resizer);delete this._resizer;}if(this._resizeHandle){_4.disconnect(this._resizeHandle);delete this._resizeHandle;}this.inherited(arguments);}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _1f=o.args.name.toLowerCase();if(_1f==="viewsource"){o.plugin=new _5._editor.plugins.ViewSource({readOnly:("readOnly" in o.args)?o.args.readOnly:false,stripComments:("stripComments" in o.args)?o.args.stripComments:true,stripScripts:("stripScripts" in o.args)?o.args.stripScripts:true,stripIFrames:("stripIFrames" in o.args)?o.args.stripIFrames:true});}});}}};});