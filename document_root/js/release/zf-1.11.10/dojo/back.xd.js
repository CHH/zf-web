/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo.back"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo.back"]){_4._hasResource["dojo.back"]=true;_4.provide("dojo.back");(function(){var _7=_4.back;function _8(){var h=window.location.hash;if(h.charAt(0)=="#"){h=h.substring(1);}return _4.isMozilla?h:decodeURIComponent(h);};function _9(h){if(!h){h="";}window.location.hash=encodeURIComponent(h);_a=history.length;};if(_4.exists("tests.back-hash")){_7.getHash=_8;_7.setHash=_9;}var _b=(typeof (window)!=="undefined")?window.location.href:"";var _c=(typeof (window)!=="undefined")?_8():"";var _d=null;var _e=null;var _f=null;var _10=null;var _11=[];var _12=[];var _13=false;var _14=false;var _a;function _15(){var _16=_12.pop();if(!_16){return;}var _17=_12[_12.length-1];if(!_17&&_12.length==0){_17=_d;}if(_17){if(_17.kwArgs["back"]){_17.kwArgs["back"]();}else{if(_17.kwArgs["backButton"]){_17.kwArgs["backButton"]();}else{if(_17.kwArgs["handle"]){_17.kwArgs.handle("back");}}}}_11.push(_16);};_7.goBack=_15;function _18(){var _19=_11.pop();if(!_19){return;}if(_19.kwArgs["forward"]){_19.kwArgs.forward();}else{if(_19.kwArgs["forwardButton"]){_19.kwArgs.forwardButton();}else{if(_19.kwArgs["handle"]){_19.kwArgs.handle("forward");}}}_12.push(_19);};_7.goForward=_18;function _1a(url,_1b,_1c){return {"url":url,"kwArgs":_1b,"urlHash":_1c};};function _1d(url){var _1e=url.split("?");if(_1e.length<2){return null;}else{return _1e[1];}};function _1f(){var url=(_4.config["dojoIframeHistoryUrl"]||_4.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date()).getTime();_13=true;if(_10){_4.isWebKit?_10.location=url:window.frames[_10.name].location=url;}else{}return url;};function _20(){if(!_14){var hsl=_12.length;var _21=_8();if((_21===_c||window.location.href==_b)&&(hsl==1)){_15();return;}if(_11.length>0){if(_11[_11.length-1].urlHash===_21){_18();return;}}if((hsl>=2)&&(_12[hsl-2])){if(_12[hsl-2].urlHash===_21){_15();return;}}if(_4.isSafari&&_4.isSafari<3){var _22=history.length;if(_22>_a){_18();}else{if(_22<_a){_15();}}_a=_22;}}};_7.init=function(){if(_4.byId("dj_history")){return;}var src=_4.config["dojoIframeHistoryUrl"]||_4.moduleUrl("dojo","resources/iframe_history.html");if(_4._postLoad){console.error("dojo.back.init() must be called before the DOM has loaded. "+"If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back "+"in a build layer.");}else{document.write("<iframe style=\"border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;\" name=\"dj_history\" id=\"dj_history\" src=\""+src+"\"></iframe>");}};_7.setInitialState=function(_23){_d=_1a(_b,_23,_c);};_7.addToHistory=function(_24){_11=[];var _25=null;var url=null;if(!_10){if(_4.config["useXDomain"]&&!_4.config["dojoIframeHistoryUrl"]){console.warn("dojo.back: When using cross-domain Dojo builds,"+" please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl"+" to the path on your domain to iframe_history.html");}_10=window.frames["dj_history"];}if(!_f){_f=_4.create("a",{style:{display:"none"}},_4.body());}if(_24["changeUrl"]){_25=""+((_24["changeUrl"]!==true)?_24["changeUrl"]:(new Date()).getTime());if(_12.length==0&&_d.urlHash==_25){_d=_1a(url,_24,_25);return;}else{if(_12.length>0&&_12[_12.length-1].urlHash==_25){_12[_12.length-1]=_1a(url,_24,_25);return;}}_14=true;setTimeout(function(){_9(_25);_14=false;},1);_f.href=_25;if(_4.isIE){url=_1f();var _26=_24["back"]||_24["backButton"]||_24["handle"];var tcb=function(_27){if(_8()!=""){setTimeout(function(){_9(_25);},1);}_26.apply(this,[_27]);};if(_24["back"]){_24.back=tcb;}else{if(_24["backButton"]){_24.backButton=tcb;}else{if(_24["handle"]){_24.handle=tcb;}}}var _28=_24["forward"]||_24["forwardButton"]||_24["handle"];var tfw=function(_29){if(_8()!=""){_9(_25);}if(_28){_28.apply(this,[_29]);}};if(_24["forward"]){_24.forward=tfw;}else{if(_24["forwardButton"]){_24.forwardButton=tfw;}else{if(_24["handle"]){_24.handle=tfw;}}}}else{if(!_4.isIE){if(!_e){_e=setInterval(_20,200);}}}}else{url=_1f();}_12.push(_1a(url,_24,_25));};_7._iframeLoaded=function(evt,_2a){var _2b=_1d(_2a.href);if(_2b==null){if(_12.length==1){_15();}return;}if(_13){_13=false;return;}if(_12.length>=2&&_2b==_1d(_12[_12.length-2].url)){_15();}else{if(_11.length>0&&_2b==_1d(_11[_11.length-1].url)){_18();}}};})();}}};});