/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid.enhanced._Plugin"],["require","dojox.grid.enhanced._Builder"],["require","dojox.grid.enhanced._Events"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid.enhanced._Plugin"]){_4._hasResource["dojox.grid.enhanced._Plugin"]=true;_4.provide("dojox.grid.enhanced._Plugin");_4.require("dojox.grid.enhanced._Builder");_4.require("dojox.grid.enhanced._Events");_4.declare("dojox.grid.enhanced._Plugin",null,{fixedCellNum:-1,funcMap:{},rowSelectionChangedTopic:"ROW_SELECTION_CHANGED",sortRowSelectionChangedTopic:"SORT_ROW_SELECTION_CHANGED",rowMovedTopic:"ROW_MOVED",constructor:function(_7){this.grid=_7;this._parseProps(this.grid);},_parseProps:function(_8){_8.plugins&&_4.mixin(_8,_8.plugins);_8.rowSelectionChangedTopic=this.rowSelectionChangedTopic;_8.sortRowSelectionChangedTopic=this.sortRowSelectionChangedTopic;_8.rowSelectCell=null;_8.dnd&&(_8.nestedSorting=true);(_8.dnd||_8.indirectSelection)&&(_8.columnReordering=false);},preInit:function(){var _9=this.grid;_9.indirectSelection&&(new (this.getPluginClazz("dojox.grid.enhanced.plugins.IndirectSelection"))(_9));if(_9.dnd&&(!_9.rowSelector||_9.rowSelector=="false")){_9.rowSelector="20px";}if(_9.nestedSorting){_6.grid._View.prototype._headerBuilderClass=_6.grid.enhanced._HeaderBuilder;}_6.grid._View.prototype._contentBuilderClass=_6.grid.enhanced._ContentBuilder;},postInit:function(){var _a=this.grid;new _6.grid.enhanced._Events(_a);_a.menus&&(new (this.getPluginClazz("dojox.grid.enhanced.plugins.Menu"))(_a));_a.nestedSorting&&(new (this.getPluginClazz("dojox.grid.enhanced.plugins.NestedSorting"))(_a));if(_a.dnd){_a.isDndSelectEnable=_a.dnd;_a.dndDisabledTypes=["cell"];new (this.getPluginClazz("dojox.grid.enhanced.plugins.DnD"))(_a);}_4.isChrome<3&&(_a.constructor.prototype.startup=_a.startup);this.fixedCellNum=this.getFixedCellNumber();this._bindFuncs();},getPluginClazz:function(_b){var _c=_4.getObject(_b);if(_c){return _c;}throw new Error("Please make sure class \""+_b+"\" is required.");},isFixedCell:function(_d){return _d&&(_d.isRowSelector||_d.positionFixed);},getFixedCellNumber:function(){if(this.fixedCellNum>=0){return this.fixedCellNum;}var i=0;_4.forEach(this.grid.layout.cells,_4.hitch(this,function(_e){this.isFixedCell(_e)&&(i++);}));return i;},inSingleSelection:function(){return this.grid.selectionMode&&this.grid.selectionMode=="single";},needUpdateRow:function(){return ((this.grid.indirectSelection||this.grid.isDndSelectEnable)?this.grid.edit.isEditing():true);},_bindFuncs:function(){_4.forEach(this.grid.views.views,_4.hitch(this,function(_f){_6.grid.util.funnelEvents(_f.contentNode,_f,"doContentEvent",["mouseup","mousemove"]);_6.grid.util.funnelEvents(_f.headerNode,_f,"doHeaderEvent",["mouseup"]);this.funcMap[_f.id+"-"+"setColumnsWidth"]=_f.setColumnsWidth;_f.setColumnsWidth=this.setColumnsWidth;this.grid.nestedSorting&&(_f._getHeaderContent=this.grid._getNestedSortHeaderContent);this.grid.dnd&&(_f.setScrollTop=this.setScrollTop);}));this.funcMap["nextKey"]=this.grid.focus.nextKey;this.grid.focus.nextKey=this.nextKey;this.funcMap["previousKey"]=this.grid.focus.previousKey;this.grid.focus.previousKey=this.previousKey;if(this.grid.indirectSelection){this.funcMap["renderPage"]=this.grid.scroller.renderPage;this.grid.scroller.renderPage=this.renderPage;}this.funcMap["updateRow"]=this.grid.updateRow;this.grid.updateRow=this.updateRow;if(this.grid.nestedSorting){_6.grid.cells._Base.prototype.getEditNode=this.getEditNode;_6.grid.cells._Widget.prototype.sizeWidget=this.sizeWidget;}_6.grid._EditManager.prototype.styleRow=function(_10){};},setColumnsWidth:function(_11){if(_4.isIE&&!_4._isBodyLtr()){this.headerContentNode.style.width=_11+"px";this.headerContentNode.parentNode.style.width=_11+"px";}_4.hitch(this,this.grid.pluginMgr.funcMap[this.id+"-"+"setColumnsWidth"])(_11);},previousKey:function(e){var _12=this.grid.edit.isEditing();if(!_12&&!this.isNavHeader()&&!this._isHeaderHidden()){if(!this.grid.isDndSelectEnable){this.focusHeader();}else{if(!this.isRowBar()){this.focusRowBar();}else{this._blurRowBar();this.focusHeader();}}_4.stopEvent(e);return;}_4.hitch(this,this.grid.pluginMgr.funcMap["previousKey"])(e);},nextKey:function(e){var _13=this.grid.rowCount==0;var _14=(e.target===this.grid.domNode);if(!_14&&this.grid.isDndSelectEnable&&this.isNavHeader()){this._colHeadNode=this._colHeadFocusIdx=null;this.focusRowBar();return;}else{if(!_14&&(!this.grid.isDndSelectEnable&&this.isNavHeader())||(this.grid.isDndSelectEnable&&this.isRowBar())){this._colHeadNode=this._colHeadFocusIdx=null;if(this.grid.isDndSelectEnable){this._blurRowBar();}if(this.isNoFocusCell()&&!_13){this.setFocusIndex(0,0);}else{if(this.cell&&!_13){if(this.focusView&&!this.focusView.rowNodes[this.rowIndex]){this.grid.scrollToRow(this.rowIndex);}this.focusGrid();}else{if(!this.findAndFocusGridCell()){this.tabOut(this.grid.lastFocusNode);}}}return;}}_4.hitch(this,this.grid.pluginMgr.funcMap["nextKey"])(e);},renderPage:function(_15){for(var i=0,j=_15*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){}this.grid.lastRenderingRowIdx=--j;_4.addClass(this.grid.domNode,"dojoxGridSortInProgress");_4.hitch(this,this.grid.pluginMgr.funcMap["renderPage"])(_15);},updateRow:function(_16){var _17=arguments.callee.caller;if(_17.nom=="move"&&!this.pluginMgr.needUpdateRow()){return;}_4.hitch(this,this.pluginMgr.funcMap["updateRow"])(_16);},getEditNode:function(_18){return ((this.getNode(_18)||0).firstChild||0).firstChild||0;},sizeWidget:function(_19,_1a,_1b){var p=this.getNode(_1b).firstChild,box=_4.contentBox(p);_4.marginBox(this.widget.domNode,{w:box.w});},setScrollTop:function(_1c){this.lastTop=_1c;this.scrollboxNode.scrollTop=_1c;return this.scrollboxNode.scrollTop;},getViewByCellIdx:function(_1d){var _1e=function(_1f){var j=0,_20=false;for(;j<_1f.length;j++){if(_4.isArray(_1f[j])){if(_1e(_1f[j])){return true;}}else{if(_1f[j].index==_1d){return true;}}}};var i=0,_21=this.grid.views.views;for(;i<_21.length;i++){cells=_21[i].structure.cells;if(_1e(cells)){return _21[i];}}return null;}});}}};});