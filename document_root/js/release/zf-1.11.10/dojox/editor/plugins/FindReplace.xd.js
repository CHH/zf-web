/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.FindReplace"],["require","dijit._editor._Plugin"],["require","dijit.Toolbar"],["require","dijit.form.TextBox"],["require","dijit.form.CheckBox"],["require","dijit.form.Button"],["require","dijit.TooltipDialog"],["require","dijit.Menu"],["require","dijit.CheckedMenuItem"],["require","dojox.editor.plugins.ToolbarLineBreak"],["require","dojo.i18n"],["require","dojo.string"],["requireLocalization","dojox.editor.plugins","FindReplace",null,"ROOT,ko","ROOT,ko"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.FindReplace"]){_4._hasResource["dojox.editor.plugins.FindReplace"]=true;_4.provide("dojox.editor.plugins.FindReplace");_4.require("dijit._editor._Plugin");_4.require("dijit.Toolbar");_4.require("dijit.form.TextBox");_4.require("dijit.form.CheckBox");_4.require("dijit.form.Button");_4.require("dijit.TooltipDialog");_4.require("dijit.Menu");_4.require("dijit.CheckedMenuItem");_4.require("dojox.editor.plugins.ToolbarLineBreak");_4.require("dojo.i18n");_4.require("dojo.string");_4.experimental("dojox.editor.plugins.FindReplace");_4.declare("dojox.editor.plugins._FindReplaceTextBox",[_5._Widget,_5._Templated],{textId:"",label:"",widget:null,widgetsInTemplate:true,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline findReplaceTextBox'>"+"<label class='dijitLeft dijitInline' for='${textId}'>${label}</label>"+"<input dojoType='dijit.form.TextBox' required=false intermediateChanges='true'"+"tabIndex='-1' id='${textId}' dojoAttachPoint='textBox' value='' style='width: 20em;'/>"+"</span>",postMixInProperties:function(){this.inherited(arguments);this.id=_5.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.textId=this.id+"_text";this.inherited(arguments);},postCreate:function(){this.textBox.attr("value","");this.disabled=this.textBox.attr("disabled");this.connect(this.textBox,"onChange","onChange");},_setValueAttr:function(_7){this.value=_7;this.textBox.attr("value",_7);},focus:function(){this.textBox.focus();},_setDisabledAttr:function(_8){this.disabled=_8;this.textBox.attr("disabled",_8);},onChange:function(_9){this.value=_9;}});_4.declare("dojox.editor.plugins._FindReplaceCheckBox",[_5._Widget,_5._Templated],{checkId:"",label:"",widget:null,widgetsInTemplate:true,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline findReplaceCheckBox'>"+"<input dojoType='dijit.form.CheckBox' required=false "+"tabIndex='-1' id='${checkId}' dojoAttachPoint='checkBox' value=''/>"+"<label class='dijitLeft dijitInline' for='${checkId}'>${label}</label>"+"</span>",postMixInProperties:function(){this.inherited(arguments);this.id=_5.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.checkId=this.id+"_check";this.inherited(arguments);},postCreate:function(){this.checkBox.attr("checked",false);this.disabled=this.checkBox.attr("disabled");this.checkBox.isFocusable=function(){return false;};},_setValueAttr:function(_a){this.checkBox.attr("value",_a);},_getValueAttr:function(){return this.checkBox.attr("value");},focus:function(){this.checkBox.focus();},_setDisabledAttr:function(_b){this.disabled=_b;this.checkBox.attr("disabled",_b);}});_4.declare("dojox.editor.plugins.FindReplace",[_5._editor._Plugin],{buttonClass:_5.form.ToggleButton,iconClassPrefix:"dijitAdditionalEditorIcon",_initButton:function(){var _c=_4.i18n.getLocalization("dojox.editor.plugins","FindReplace");this.button=new _5.form.ToggleButton({label:_c["findReplace"],showLabel:false,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"FindReplace",tabIndex:"-1",onChange:_4.hitch(this,"_toggleFindReplace")});if(_4.isOpera){this.button.attr("disabled",true);}this.connect(this.button,"attr",_4.hitch(this,function(_d,_e){if(_d==="disabled"){this._toggleFindReplace((!_e&&this._displayed),true);}}));},setEditor:function(_f){this.editor=_f;this._initButton();},toggle:function(){this.button.attr("checked",!this.button.attr("checked"));},_toggleFindReplace:function(_10,_11){var _12=_4.marginBox(this.editor.domNode);if(_10&&!_4.isOpera){_4.style(this._frToolbar.domNode,"display","block");if(!_11){this._displayed=true;}}else{_4.style(this._frToolbar.domNode,"display","none");if(!_11){this._displayed=false;}}this.editor.resize({h:_12.h});},setToolbar:function(_13){this.inherited(arguments);if(!_4.isOpera){var _14=_4.i18n.getLocalization("dojox.editor.plugins","FindReplace");this._frToolbar=new _5.Toolbar();_4.style(this._frToolbar.domNode,"display","none");_4.place(this._frToolbar.domNode,_13.domNode,"after");this._frToolbar.startup();this._caseSensitive=new _6.editor.plugins._FindReplaceCheckBox({label:_14["matchCase"]});this._backwards=new _6.editor.plugins._FindReplaceCheckBox({label:_14["backwards"]});this._replaceAll=new _6.editor.plugins._FindReplaceCheckBox({label:_14["replaceAll"]});this._findField=new _6.editor.plugins._FindReplaceTextBox({label:_14.findLabel});this._frToolbar.addChild(this._findField);this._findButton=new _5.form.Button({label:_14["findButton"],showLabel:true,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"FindRun"});this._frToolbar.addChild(this._findButton);this._frToolbar.addChild(this._caseSensitive);this._frToolbar.addChild(this._backwards);this._frToolbar.addChild(new _6.editor.plugins._ToolbarLineBreak());this._replaceField=new _6.editor.plugins._FindReplaceTextBox({label:_14.replaceLabel});this._frToolbar.addChild(this._replaceField);this._replaceButton=new _5.form.Button({label:_14["replaceButton"],showLabel:true,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ReplaceRun"});this._frToolbar.addChild(this._replaceButton);this._frToolbar.addChild(this._replaceAll);this._findButton.attr("disabled",true);this._replaceButton.attr("disabled",true);this.connect(this._findField,"onChange","_checkButtons");this.connect(this._replaceField,"onChange","_checkButtons");this.connect(this._findButton,"onClick","_find");this.connect(this._replaceButton,"onClick","_replace");this._replDialog=new _5.TooltipDialog();this._replDialog.startup();this._replDialog.attr("content","");this._dialogTemplate=_14.replaceDialogText;}},_checkButtons:function(){var _15=this._findField.attr("value");var _16=this._replaceField.attr("value");if(_15){this._findButton.attr("disabled",false);}else{this._findButton.attr("disabled",true);}if(_15&&_16&&_15!==_16){this._replaceButton.attr("disabled",false);}else{this._replaceButton.attr("disabled",true);}},_find:function(){var txt=this._findField.attr("value");if(txt){var _17=this._caseSensitive.attr("value");var _18=this._backwards.attr("value");return this._findText(txt,_17,_18);}return false;},_replace:function(){var ed=this.editor;ed.focus();var txt=this._findField.attr("value");var _19=this._replaceField.attr("value");var _1a=0;if(txt){if(this._replaceDialogTimeout){clearTimeout(this._replaceDialogTimeout);this._replaceDialogTimeout=null;_5.popup.close(this._replDialog);}var _1b=this._replaceAll.attr("value");var _1c=this._caseSensitive.attr("value");var _1d=this._backwards.attr("value");var _1e=_4.withGlobal(ed.window,"getSelectedText",_5._editor.selection,[null]);if(_4.isMoz){txt=_4.trim(txt);_1e=_4.trim(_1e);}var _1f=this._filterRegexp(txt,!_1c);if(_1e&&_1f.test(_1e)){ed.execCommand("inserthtml",_19);_1a++;}if(_1b){var _20=this._findText(txt,_1c,_1d);var _21=function(){ed.execCommand("inserthtml",_19);_1a++;_20=this._findText(txt,_1c,_1d);if(_20){setTimeout(_4.hitch(this,_21),10);}else{this._replDialog.attr("content",_4.string.substitute(this._dialogTemplate,{"0":""+_1a}));_5.popup.open({popup:this._replDialog,around:this._replaceButton.domNode});this._replaceDialogTimeout=setTimeout(_4.hitch(this,function(){clearTimeout(this._replaceDialogTimeout);this._replaceDialogTimeout=null;_5.popup.close(this._replDialog);}),5000);}};if(_20){var _22=_4.hitch(this,_21);_22();}}}},_findText:function(txt,_23,_24){var ed=this.editor;var win=ed.window;var _25=false;if(txt){if(win.find){_25=win.find(txt,_23,_24,false,false,false,false);}else{var doc=ed.document;if(doc.selection){this.editor.focus();var _26=doc.body.createTextRange();var _27=doc.selection?doc.selection.createRange():null;if(_27){if(_24){_26.setEndPoint("EndToStart",_27);}else{_26.setEndPoint("StartToEnd",_27);}}var _28=_23?4:0;if(_24){_28=_28|1;}_25=_26.findText(txt,null,_28);if(_25){_26.select();}}}}return _25;},_filterRegexp:function(_29,_2a){var rxp="";var c=null;for(var i=0;i<_29.length;i++){c=_29.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_29.charAt(i);break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp="^"+rxp+"$";if(_2a){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}},destroy:function(){this.inherited(arguments);if(this._replaceDialogTimeout){clearTimeout(this._replaceDialogTimeout);this._replaceDialogTimeout=null;_5.popup.close(this._replDialog);}if(this._frToolbar){this._frToolbar.destroyRecursive();this._frToolbar=null;}if(this._replDialog){this._replDialog.destroyRecursive();this._replDialog=null;}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _2b=o.args.name.toLowerCase();if(_2b==="findreplace"){o.plugin=new _6.editor.plugins.FindReplace({});}});}}};});