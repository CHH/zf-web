/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.form.ComboBox"],["require","dijit.form._FormWidget"],["require","dijit.form.ValidationTextBox"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"],["require","dojo.regexp"],["requireLocalization","dijit.form","ComboBox",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.form.ComboBox"]){_4._hasResource["dijit.form.ComboBox"]=true;_4.provide("dijit.form.ComboBox");_4.require("dijit.form._FormWidget");_4.require("dijit.form.ValidationTextBox");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.require("dojo.regexp");_4.declare("dijit.form.ComboBoxMixin",null,{item:null,pageSize:Infinity,store:null,fetchProperties:{},query:{},autoComplete:true,highlightMatch:"first",searchDelay:100,searchAttr:"name",labelAttr:"",labelType:"text",queryExpr:"${0}*",ignoreCase:true,hasDownArrow:true,templateString:_4.cache("dijit.form","templates/ComboBox.html","<div class=\"dijit dijitReset dijitInlineTable dijitLeft\"\n\tid=\"widget_${id}\"\n\tdojoAttachPoint=\"comboNode\" waiRole=\"combobox\" tabIndex=\"-1\"\n\t><div style=\"overflow:hidden;\"\n\t\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton'\n\t\t\tdojoAttachPoint=\"downArrowNode\" waiRole=\"presentation\"\n\t\t\tdojoAttachEvent=\"onmousedown:_onArrowMouseDown\"\n\t\t\t><div class=\"dijitArrowButtonInner\">&thinsp;</div\n\t\t\t><div class=\"dijitArrowButtonChar\">&#9660;</div\n\t\t></div\n\t\t><div class=\"dijitReset dijitValidationIcon\"><br></div\n\t\t><div class=\"dijitReset dijitValidationIconText\">&Chi;</div\n\t\t><div class=\"dijitReset dijitInputField\"\n\t\t\t><input ${nameAttrSetting} type=\"text\" autocomplete=\"off\" class='dijitReset'\n\t\t\tdojoAttachEvent=\"onkeypress:_onKeyPress,compositionend\"\n\t\t\tdojoAttachPoint=\"textbox,focusNode\" waiRole=\"textbox\" waiState=\"haspopup-true,autocomplete-list\"\n\t\t/></div\n\t></div\n></div>\n"),baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{"downArrowNode":"dijitDownArrowButton"},_getCaretPos:function(_7){var _8=0;if(typeof (_7.selectionStart)=="number"){_8=_7.selectionStart;}else{if(_4.isIE){var tr=_4.doc.selection.createRange().duplicate();var _9=_7.createTextRange();tr.move("character",0);_9.move("character",0);try{_9.setEndPoint("EndToEnd",tr);_8=String(_9.text).replace(/\r/g,"").length;}catch(e){}}}return _8;},_setCaretPos:function(_a,_b){_b=parseInt(_b);_5.selectInputText(_a,_b,_b);},_setDisabledAttr:function(_c){this.inherited(arguments);_5.setWaiState(this.comboNode,"disabled",_c);},_abortQuery:function(){if(this.searchTimer){clearTimeout(this.searchTimer);this.searchTimer=null;}if(this._fetchHandle){if(this._fetchHandle.abort){this._fetchHandle.abort();}this._fetchHandle=null;}},_onKeyPress:function(_d){var _e=_d.charOrCode;if(_d.altKey||((_d.ctrlKey||_d.metaKey)&&(_e!="x"&&_e!="v"))||_e==_4.keys.SHIFT){return;}var _f=false;var _10="_startSearchFromInput";var pw=this._popupWidget;var dk=_4.keys;var _11=null;this._prev_key_backspace=false;this._abortQuery();if(this._isShowingNow){pw.handleKey(_e);_11=pw.getHighlightedOption();}switch(_e){case dk.PAGE_DOWN:case dk.DOWN_ARROW:case dk.PAGE_UP:case dk.UP_ARROW:if(!this._isShowingNow){_f=true;_10="_startSearchAll";}else{this._announceOption(_11);}_4.stopEvent(_d);break;case dk.ENTER:if(_11){if(_11==pw.nextButton){this._nextSearch(1);_4.stopEvent(_d);break;}else{if(_11==pw.previousButton){this._nextSearch(-1);_4.stopEvent(_d);break;}}}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length);}_d.preventDefault();case dk.TAB:var _12=this.attr("displayedValue");if(pw&&(_12==pw._messages["previousMessage"]||_12==pw._messages["nextMessage"])){break;}if(_11){this._selectOption();}if(this._isShowingNow){this._lastQuery=null;this._hideResultList();}break;case " ":if(_11){_4.stopEvent(_d);this._selectOption();this._hideResultList();}else{_f=true;}break;case dk.ESCAPE:if(this._isShowingNow){_4.stopEvent(_d);this._hideResultList();}break;case dk.DELETE:case dk.BACKSPACE:this._prev_key_backspace=true;_f=true;break;default:_f=typeof _e=="string"||_e==229;}if(_f){this.item=undefined;this.searchTimer=setTimeout(_4.hitch(this,_10),1);}},_autoCompleteText:function(_13){var fn=this.focusNode;_5.selectInputText(fn,fn.value.length);var _14=this.ignoreCase?"toLowerCase":"substr";if(_13[_14](0).indexOf(this.focusNode.value[_14](0))==0){var _15=this._getCaretPos(fn);if((_15+1)>fn.value.length){fn.value=_13;_5.selectInputText(fn,_15);}}else{fn.value=_13;_5.selectInputText(fn);}},_openResultList:function(_16,_17){this._fetchHandle=null;if(this.disabled||this.readOnly||(_17.query[this.searchAttr]!=this._lastQuery)){return;}this._popupWidget.clearResultList();if(!_16.length&&!this._maxOptions){this._hideResultList();return;}_17._maxOptions=this._maxOptions;var _18=this._popupWidget.createOptions(_16,_17,_4.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if(_17.direction){if(1==_17.direction){this._popupWidget.highlightFirstOption();}else{if(-1==_17.direction){this._popupWidget.highlightLastOption();}}this._announceOption(this._popupWidget.getHighlightedOption());}else{if(this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(_17.query[this.searchAttr])){this._announceOption(_18[1]);}}},_showResultList:function(){this._hideResultList();this.displayMessage("");_4.style(this._popupWidget.domNode,{width:"",height:""});var _19=this.open();var _1a=_4.marginBox(this._popupWidget.domNode);this._popupWidget.domNode.style.overflow=((_19.h==_1a.h)&&(_19.w==_1a.w))?"hidden":"auto";var _1b=_19.w;if(_19.h<this._popupWidget.domNode.scrollHeight){_1b+=16;}_4.marginBox(this._popupWidget.domNode,{h:_19.h,w:Math.max(_1b,this.domNode.offsetWidth)});if(_1b<this.domNode.offsetWidth){this._popupWidget.domNode.parentNode.style.left=_4.position(this.domNode).x+"px";}_5.setWaiState(this.comboNode,"expanded","true");},_hideResultList:function(){this._abortQuery();if(this._isShowingNow){_5.popup.close(this._popupWidget);this._isShowingNow=false;_5.setWaiState(this.comboNode,"expanded","false");_5.removeWaiState(this.focusNode,"activedescendant");}},_setBlurValue:function(){var _1c=this.attr("displayedValue");var pw=this._popupWidget;if(pw&&(_1c==pw._messages["previousMessage"]||_1c==pw._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true);}else{if(typeof this.item=="undefined"){this.item=null;this.attr("displayedValue",_1c);}else{if(this.value!=this._lastValueReported){_5.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true);}this._refreshState();}}},_onBlur:function(){this._hideResultList();this.inherited(arguments);},_setItemAttr:function(_1d,_1e,_1f){if(!_1f){_1f=this.labelFunc(_1d,this.store);}this.value=this._getValueField()!=this.searchAttr?this.store.getIdentity(_1d):_1f;this.item=_1d;_5.form.ComboBox.superclass._setValueAttr.call(this,this.value,_1e,_1f);},_announceOption:function(_20){if(!_20){return;}var _21;if(_20==this._popupWidget.nextButton||_20==this._popupWidget.previousButton){_21=_20.innerHTML;this.item=undefined;this.value="";}else{_21=this.labelFunc(_20.item,this.store);this.attr("item",_20.item,false,_21);}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);_5.setWaiState(this.focusNode,"activedescendant",_4.attr(_20,"id"));this._autoCompleteText(_21);},_selectOption:function(evt){if(evt){this._announceOption(evt.target);}this._hideResultList();this._setCaretPos(this.focusNode,this.focusNode.value.length);_5.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true);},_onArrowMouseDown:function(evt){if(this.disabled||this.readOnly){return;}_4.stopEvent(evt);this.focus();if(this._isShowingNow){this._hideResultList();}else{this._startSearchAll();}},_startSearchAll:function(){this._startSearch("");},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));},_getQueryString:function(_22){return _4.string.substitute(this.queryExpr,[_22]);},_startSearch:function(key){if(!this._popupWidget){var _23=this.id+"_popup";this._popupWidget=new _5.form._ComboBoxMenu({onChange:_4.hitch(this,this._selectOption),id:_23});_5.removeWaiState(this.focusNode,"activedescendant");_5.setWaiState(this.textbox,"owns",_23);}var _24=_4.clone(this.query);this._lastInput=key;this._lastQuery=_24[this.searchAttr]=this._getQueryString(key);this.searchTimer=setTimeout(_4.hitch(this,function(_25,_26){this.searchTimer=null;var _27={queryOptions:{ignoreCase:this.ignoreCase,deep:true},query:_25,onBegin:_4.hitch(this,"_setMaxOptions"),onComplete:_4.hitch(this,"_openResultList"),onError:function(_28){_26._fetchHandle=null;console.error("dijit.form.ComboBox: "+_28);_4.hitch(_26,"_hideResultList")();},start:0,count:this.pageSize};_4.mixin(_27,_26.fetchProperties);this._fetchHandle=_26.store.fetch(_27);var _29=function(_2a,_2b){_2a.start+=_2a.count*_2b;_2a.direction=_2b;this._fetchHandle=this.store.fetch(_2a);};this._nextSearch=this._popupWidget.onPage=_4.hitch(this,_29,this._fetchHandle);},_24,this),this.searchDelay);},_setMaxOptions:function(_2c,_2d){this._maxOptions=_2c;},_getValueField:function(){return this.searchAttr;},compositionend:function(evt){this._onKeyPress({charOrCode:229});},constructor:function(){this.query={};this.fetchProperties={};},postMixInProperties:function(){if(!this.store){var _2e=this.srcNodeRef;this.store=new _5.form._ComboBoxDataStore(_2e);if(!("value" in this.params)){var _2f=this.store.fetchSelectedItem();if(_2f){var _30=this._getValueField();this.value=_30!=this.searchAttr?this.store.getValue(_2f,_30):this.labelFunc(_2f,this.store);}}}this.inherited(arguments);},postCreate:function(){if(!this.hasDownArrow){this.downArrowNode.style.display="none";}var _31=_4.query("label[for=\""+this.id+"\"]");if(_31.length){_31[0].id=(this.id+"_label");var cn=this.comboNode;_5.setWaiState(cn,"labelledby",_31[0].id);}this.inherited(arguments);},uninitialize:function(){if(this._popupWidget&&!this._popupWidget._destroyed){this._hideResultList();this._popupWidget.destroy();}this.inherited(arguments);},_getMenuLabelFromItem:function(_32){var _33=this.labelAttr?this.store.getValue(_32,this.labelAttr):this.labelFunc(_32,this.store);var _34=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){_33=this.doHighlight(_33,this._escapeHtml(this._lastInput));_34="html";}return {html:_34=="html",label:_33};},doHighlight:function(_35,_36){var _37="i"+(this.highlightMatch=="all"?"g":"");var _38=this._escapeHtml(_35);_36=_4.regexp.escapeString(_36);var ret=_38.replace(new RegExp("(^|\\s)("+_36+")",_37),"$1<span class=\"dijitComboBoxHighlightMatch\">$2</span>");return ret;},_escapeHtml:function(str){str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");return str;},open:function(){this._isShowingNow=true;return _5.popup.open({popup:this._popupWidget,around:this.domNode,parent:this});},reset:function(){this.item=null;this.inherited(arguments);},labelFunc:function(_39,_3a){return _3a.getValue(_39,this.searchAttr).toString();}});_4.declare("dijit.form._ComboBoxMenu",[_5._Widget,_5._Templated],{templateString:"<ul class='dijitReset dijitMenu' dojoAttachEvent='onmousedown:_onMouseDown,onmouseup:_onMouseUp,onmouseover:_onMouseOver,onmouseout:_onMouseOut' tabIndex='-1' style='overflow: \"auto\"; overflow-x: \"hidden\";'>"+"<li class='dijitMenuItem dijitMenuPreviousButton' dojoAttachPoint='previousButton' waiRole='option'></li>"+"<li class='dijitMenuItem dijitMenuNextButton' dojoAttachPoint='nextButton' waiRole='option'></li>"+"</ul>",_messages:null,postMixInProperties:function(){this._messages=_4.i18n.getLocalization("dijit.form","ComboBox",this.lang);this.inherited(arguments);},_setValueAttr:function(_3b){this.value=_3b;this.onChange(_3b);},onChange:function(_3c){},onPage:function(_3d){},postCreate:function(){this.previousButton.innerHTML=this._messages["previousMessage"];this.nextButton.innerHTML=this._messages["nextMessage"];this.inherited(arguments);},onClose:function(){this._blurOptionNode();},_createOption:function(_3e,_3f){var _40=_3f(_3e);var _41=_4.doc.createElement("li");_5.setWaiRole(_41,"option");if(_40.html){_41.innerHTML=_40.label;}else{_41.appendChild(_4.doc.createTextNode(_40.label));}if(_41.innerHTML==""){_41.innerHTML="&nbsp;";}_41.item=_3e;return _41;},createOptions:function(_42,_43,_44){this.previousButton.style.display=(_43.start==0)?"none":"";_4.attr(this.previousButton,"id",this.id+"_prev");_4.forEach(_42,function(_45,i){var _46=this._createOption(_45,_44);_46.className="dijitReset dijitMenuItem";_4.attr(_46,"id",this.id+i);this.domNode.insertBefore(_46,this.nextButton);},this);var _47=false;if(_43._maxOptions&&_43._maxOptions!=-1){if((_43.start+_43.count)<_43._maxOptions){_47=true;}else{if((_43.start+_43.count)>_43._maxOptions&&_43.count==_42.length){_47=true;}}}else{if(_43.count==_42.length){_47=true;}}this.nextButton.style.display=_47?"":"none";_4.attr(this.nextButton,"id",this.id+"_next");return this.domNode.childNodes;},clearResultList:function(){while(this.domNode.childNodes.length>2){this.domNode.removeChild(this.domNode.childNodes[this.domNode.childNodes.length-2]);}},_onMouseDown:function(evt){_4.stopEvent(evt);},_onMouseUp:function(evt){if(evt.target===this.domNode||!this._highlighted_option){return;}else{if(evt.target==this.previousButton){this.onPage(-1);}else{if(evt.target==this.nextButton){this.onPage(1);}else{var tgt=evt.target;while(!tgt.item){tgt=tgt.parentNode;}this._setValueAttr({target:tgt},true);}}}},_onMouseOver:function(evt){if(evt.target===this.domNode){return;}var tgt=evt.target;if(!(tgt==this.previousButton||tgt==this.nextButton)){while(!tgt.item){tgt=tgt.parentNode;}}this._focusOptionNode(tgt);},_onMouseOut:function(evt){if(evt.target===this.domNode){return;}this._blurOptionNode();},_focusOptionNode:function(_48){if(this._highlighted_option!=_48){this._blurOptionNode();this._highlighted_option=_48;_4.addClass(this._highlighted_option,"dijitMenuItemSelected");}},_blurOptionNode:function(){if(this._highlighted_option){_4.removeClass(this._highlighted_option,"dijitMenuItemSelected");this._highlighted_option=null;}},_highlightNextOption:function(){if(!this.getHighlightedOption()){var fc=this.domNode.firstChild;this._focusOptionNode(fc.style.display=="none"?fc.nextSibling:fc);}else{var ns=this._highlighted_option.nextSibling;if(ns&&ns.style.display!="none"){this._focusOptionNode(ns);}else{this.highlightFirstOption();}}_5.scrollIntoView(this._highlighted_option);},highlightFirstOption:function(){var _49=this.domNode.firstChild;var _4a=_49.nextSibling;this._focusOptionNode(_4a.style.display=="none"?_49:_4a);_5.scrollIntoView(this._highlighted_option);},highlightLastOption:function(){this._focusOptionNode(this.domNode.lastChild.previousSibling);_5.scrollIntoView(this._highlighted_option);},_highlightPrevOption:function(){if(!this.getHighlightedOption()){var lc=this.domNode.lastChild;this._focusOptionNode(lc.style.display=="none"?lc.previousSibling:lc);}else{var ps=this._highlighted_option.previousSibling;if(ps&&ps.style.display!="none"){this._focusOptionNode(ps);}else{this.highlightLastOption();}}_5.scrollIntoView(this._highlighted_option);},_page:function(up){var _4b=0;var _4c=this.domNode.scrollTop;var _4d=_4.style(this.domNode,"height");if(!this.getHighlightedOption()){this._highlightNextOption();}while(_4b<_4d){if(up){if(!this.getHighlightedOption().previousSibling||this._highlighted_option.previousSibling.style.display=="none"){break;}this._highlightPrevOption();}else{if(!this.getHighlightedOption().nextSibling||this._highlighted_option.nextSibling.style.display=="none"){break;}this._highlightNextOption();}var _4e=this.domNode.scrollTop;_4b+=(_4e-_4c)*(up?-1:1);_4c=_4e;}},pageUp:function(){this._page(true);},pageDown:function(){this._page(false);},getHighlightedOption:function(){var ho=this._highlighted_option;return (ho&&ho.parentNode)?ho:null;},handleKey:function(key){switch(key){case _4.keys.DOWN_ARROW:this._highlightNextOption();break;case _4.keys.PAGE_DOWN:this.pageDown();break;case _4.keys.UP_ARROW:this._highlightPrevOption();break;case _4.keys.PAGE_UP:this.pageUp();break;}}});_4.declare("dijit.form.ComboBox",[_5.form.ValidationTextBox,_5.form.ComboBoxMixin],{_setValueAttr:function(_4f,_50,_51){this.item=null;if(!_4f){_4f="";}_5.form.ValidationTextBox.prototype._setValueAttr.call(this,_4f,_50,_51);}});_4.declare("dijit.form._ComboBoxDataStore",null,{constructor:function(_52){this.root=_52;if(_52.tagName!="SELECT"&&_52.firstChild){_52=_4.query("select",_52);if(_52.length>0){_52=_52[0];}else{this.root.innerHTML="<SELECT>"+this.root.innerHTML+"</SELECT>";_52=this.root.firstChild;}this.root=_52;}_4.query("> option",_52).forEach(function(_53){_53.innerHTML=_4.trim(_53.innerHTML);});},getValue:function(_54,_55,_56){return (_55=="value")?_54.value:(_54.innerText||_54.textContent||"");},isItemLoaded:function(_57){return true;},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},_fetchItems:function(_58,_59,_5a){if(!_58.query){_58.query={};}if(!_58.query.name){_58.query.name="";}if(!_58.queryOptions){_58.queryOptions={};}var _5b=_4.data.util.filter.patternToRegExp(_58.query.name,_58.queryOptions.ignoreCase),_5c=_4.query("> option",this.root).filter(function(_5d){return (_5d.innerText||_5d.textContent||"").match(_5b);});if(_58.sort){_5c.sort(_4.data.util.sorter.createSortFunction(_58.sort,this));}_59(_5c,_58);},close:function(_5e){return;},getLabel:function(_5f){return _5f.innerHTML;},getIdentity:function(_60){return _4.attr(_60,"value");},fetchItemByIdentity:function(_61){var _62=_4.query("> option[value='"+_61.identity+"']",this.root)[0];_61.onItem(_62);},fetchSelectedItem:function(){var _63=this.root,si=_63.selectedIndex;return typeof si=="number"?_4.query("> option:nth-child("+(si!=-1?si+1:1)+")",_63)[0]:null;}});_4.extend(_5.form._ComboBoxDataStore,_4.data.util.simpleFetch);}}};});